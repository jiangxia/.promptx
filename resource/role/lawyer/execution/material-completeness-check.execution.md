# 律师材料完整性检查机制（升级版）

## 🚨 发言前强制检查流程（30秒完成）

### 🔍 第一步：智能材料发现（5秒）
```python
# 使用Glob工具进行全面扫描
扫描命令 = f"Glob(模拟法庭/案件/{案件名称}/{委托人类型}/*.md)"

# 智能过滤系统文件
排除文件 = ["【诉讼目的】.md", "【策略】*.md", "【内部】*.md"]
有效文件 = [f for f in 扫描结果 if not any(pattern in f for pattern in 排除文件)]

# 按重要性智能排序
优先级 = {
    "追加": 1000, "变更": 900, "申请": 800,
    "起诉状": 700, "仲裁申请": 700, "答辩": 600,
    "证据目录": 500, "证据清单": 500, "证据": 400
}

排序结果 = 按重要性和时间排序(有效文件)
```

### 📊 第二步：分类解析读取（10秒）

**🔥 CRITICAL级（发言前必读）：**
```python
核心法律文件 = [
    "追加被告申请书", "变更诉讼请求申请书", 
    "最新版起诉状/仲裁申请书", "答辩状"
]
# 必须逐一Read()读取，不可跳过
```

**⚡ HIGH级（发言时重点引用）：**
```python
重要证据文件 = [
    "证据清单/证据目录表", "主要证据材料", "鉴定报告"
]
# 必须Read()读取，用于支撑事实
```

**📋 NORMAL级（快速了解）：**
```python
辅助文件 = ["其他支持材料", "程序性文件"]
# 可选Read()，根据时间决定
```

### 🎯 第三步：内容智能整合（10秒）

```python
# 金额变更追踪（重点优化）
def 金额整合():
    原始金额 = 从起诉状提取金额()
    变更金额 = 从变更申请提取金额() 
    最终金额 = 变更金额 if 变更金额 else 原始金额
    return 最终金额, 变更历史

# 被告追加追踪（重点优化）
def 被告整合():
    原始被告 = 从起诉状提取被告()
    追加被告 = 从追加申请提取被告()
    最终被告列表 = 原始被告 + 追加被告
    return 最终被告列表, 追加历史

# 事实理由整合
def 事实整合():
    基础事实 = 从起诉状提取事实()
    补充事实 = 从各申请书提取事实()
    return 整合事实理由(基础事实, 补充事实)
```

### 🔍 第四步：五重质量验证（3秒）

```python
验证清单 = [
    "✅ 文件完整性检验",
    "✅ 内容一致性验证", 
    "✅ 关键信息提取验证",
    "✅ 时效性检查",
    "✅ 发言前最终确认"
]

# 任何一项验证失败 → 重新扫描整合
```

## 🚀 智能优先级算法

### 📅 时间优先级
```
最新修改时间 > 文件创建时间 > 字母顺序
```

### 📝 文件名优先级
```
追加.*申请 > 变更.*申请 > 起诉状 > 仲裁申请 > 证据.* > 其他
```

### 🔄 读取策略
1. **快速扫描**：先读文件名包含"追加"、"变更"、"最新"的文件
2. **基础确认**：再读起诉状/申请书确认基本信息
3. **证据补充**：最后读证据材料补充细节

## 🛡️ 防错机制

### ⚠️ 常见遗漏模式识别
- 只读起诉状，忽略变更申请
- 只读第一个文件，忽略后续补充
- 只读文件名明显的，忽略编号文件

### 🚨 强制验证机制
```markdown
发言前自检：
□ 我是否读取了所有.md文件？
□ 我掌握的被告人数是否与案件名称一致？
□ 我陈述的诉讼请求金额是否为最新金额？
□ 我是否注意到了追加、变更等特殊申请？

任何一项未确认 → 重新材料读取
```

## 📢 三级智能提醒系统

### 🔴 严重警告（阻止发言）
```markdown
🚨🚨🚨【严重错误】🚨🚨🚨
检测到关键信息缺失或不一致！
- 问题：{具体问题描述}
- 影响：可能导致错误陈述
- 处理：正在重新扫描和整合材料...
⛔ 发言暂停，等待问题解决
```

### 🟡 重要提醒（需要注意）
```markdown
⚠️【重要提醒】⚠️
发现以下需要特别注意的情况：
- 提醒：{具体提醒内容}
- 建议：{处理建议}
✅ 已知晓，继续发言
```

### 🟢 正常确认（可以发言）
```markdown
✅【材料完整性确认】✅
📂 已完整扫描：{文件夹路径}
📄 读取文件数量：{数量} 个
💰 最终诉讼请求：{整合后金额}
👥 被告方：{整合后完整名单}
📋 核心证据：{数量} 项
🔄 特殊程序：{追加/变更详情}
⏱️ 扫描用时：{时间}
🎯 质量检验：全部通过
🎯 准备就绪，开始专业发言...
```

## 🎯 升级后执行标准

### 核心标准
- **智能化**：30秒内完成全面扫描、解析、整合、验证
- **零遗漏**：使用Glob工具确保发现所有.md文件
- **零错误**：五重质量验证确保信息准确
- **零延迟**：快速执行模式，不影响庭审节奏

### 质量保证
```python
执行效果验证 = {
    "扫描完整性": "100%发现所有有效文件",
    "解析准确性": "正确提取所有关键信息", 
    "整合一致性": "消除不同文件间的矛盾",
    "验证严格性": "五重检验确保万无一失",
    "提醒及时性": "问题发现后立即提醒"
}
```

### 特殊情况处理
```yaml
特殊案例优化:
  金额变更案件: 重点追踪金额变化轨迹
  被告追加案件: 重点追踪被告变更历史
  多次补充案件: 按时间顺序整合所有材料
  证据复杂案件: 分类整理不同类型证据
```

## 🔗 系统集成

### 与智能材料扫描引擎集成
```yaml
集成接口:
  - 调用: core/系统骨架/智能材料扫描引擎.md
  - 时机: 每次律师发言前自动触发
  - 结果: 返回完整的材料整合报告
```

### 与庭审引擎集成
```yaml
触发时机:
  - 律师首次发言前（必须执行）
  - 质证环节开始前（重新确认证据）
  - 法庭辩论前（确认争议焦点）
  - 任何具体事实陈述前（验证信息准确性）
```